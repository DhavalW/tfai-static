var Ze=Object.defineProperty;var et=(e,t,n)=>t in e?Ze(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var ue=(e,t,n)=>(et(e,typeof t!="symbol"?t+"":t,n),n);import{openDB as tt}from"https://cdn.jsdelivr.net/npm/idb@7/+esm";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const h of r.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();function A(){}function qe(e){return e()}function Le(){return Object.create(null)}function H(e){e.forEach(qe)}function ge(e){return typeof e=="function"}function _e(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}let X;function oe(e,t){return e===t?!0:(X||(X=document.createElement("a")),X.href=t,e===X.href)}function nt(e){return Object.keys(e).length===0}function He(e,...t){if(e==null){for(const s of t)s(void 0);return A}const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function ye(e){let t;return He(e,n=>t=n)(),t}function fe(e,t,n){e.$$.on_destroy.push(He(t,n))}function c(e,t){e.appendChild(t)}function I(e,t,n){e.insertBefore(t,n||null)}function S(e){e.parentNode&&e.parentNode.removeChild(e)}function st(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function d(e){return document.createElement(e)}function Y(e){return document.createTextNode(e)}function $(){return Y(" ")}function Ue(){return Y("")}function re(e,t,n,s){return e.addEventListener(t,n,s),()=>e.removeEventListener(t,n,s)}function a(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function ot(e){return Array.from(e.childNodes)}function rt(e,t){t=""+t,e.data!==t&&(e.data=t)}function Z(e,t,n,s){n==null?e.style.removeProperty(t):e.style.setProperty(t,n,s?"important":"")}function Oe(e,t,n){e.classList.toggle(t,!!n)}let be;function V(e){be=e}const M=[],je=[];let B=[];const Ee=[],it=Promise.resolve();let me=!1;function lt(){me||(me=!0,it.then(De))}function ve(e){B.push(e)}const de=new Set;let C=0;function De(){if(C!==0)return;const e=be;do{try{for(;C<M.length;){const t=M[C];C++,V(t),ct(t.$$)}}catch(t){throw M.length=0,C=0,t}for(V(null),M.length=0,C=0;je.length;)je.pop()();for(let t=0;t<B.length;t+=1){const n=B[t];de.has(n)||(de.add(n),n())}B.length=0}while(M.length);for(;Ee.length;)Ee.pop()();me=!1,de.clear(),V(e)}function ct(e){if(e.fragment!==null){e.update(),H(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(ve)}}function at(e){const t=[],n=[];B.forEach(s=>e.indexOf(s)===-1?t.push(s):n.push(s)),n.forEach(s=>s()),B=t}const se=new Set;let ut;function Re(e,t){e&&e.i&&(se.delete(e),e.i(t))}function ft(e,t,n,s){if(e&&e.o){if(se.has(e))return;se.add(e),ut.c.push(()=>{se.delete(e),s&&(n&&e.d(1),s())}),e.o(t)}else s&&s()}function Ne(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function dt(e){e&&e.c()}function Je(e,t,n){const{fragment:s,after_update:o}=e.$$;s&&s.m(t,n),ve(()=>{const r=e.$$.on_mount.map(qe).filter(ge);e.$$.on_destroy?e.$$.on_destroy.push(...r):H(r),e.$$.on_mount=[]}),o.forEach(ve)}function Ve(e,t){const n=e.$$;n.fragment!==null&&(at(n.after_update),H(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function pt(e,t){e.$$.dirty[0]===-1&&(M.push(e),lt(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Ye(e,t,n,s,o,r,h=null,v=[-1]){const m=be;V(e);const i=e.$$={fragment:null,ctx:[],props:r,update:A,not_equal:o,bound:Le(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(m?m.$$.context:[])),callbacks:Le(),dirty:v,skip_bound:!1,root:t.target||m.$$.root};h&&h(i.root);let g=!1;if(i.ctx=n?n(e,t.props||{},(_,l,...f)=>{const p=f.length?f[0]:l;return i.ctx&&o(i.ctx[_],i.ctx[_]=p)&&(!i.skip_bound&&i.bound[_]&&i.bound[_](p),g&&pt(e,_)),l}):[],i.update(),g=!0,H(i.before_update),i.fragment=s?s(i.ctx):!1,t.target){if(t.hydrate){const _=ot(t.target);i.fragment&&i.fragment.l(_),_.forEach(S)}else i.fragment&&i.fragment.c();t.intro&&Re(e.$$.fragment),Je(e,t.target,t.anchor),De()}V(m)}class ze{constructor(){ue(this,"$$");ue(this,"$$set")}$destroy(){Ve(this,1),this.$destroy=A}$on(t,n){if(!ge(n))return A;const s=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return s.push(n),()=>{const o=s.indexOf(n);o!==-1&&s.splice(o,1)}}$set(t){this.$$set&&!nt(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const ht="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(ht);const Fe=tt("keyval-store",1,{upgrade(e){e.createObjectStore("keyval")}});async function we(e){return(await Fe).get("keyval",e)}async function Te(e,t){return(await Fe).put("keyval",t,e)}const x=[];function ke(e,t=A){let n;const s=new Set;function o(v){if(_e(e,v)&&(e=v,n)){const m=!x.length;for(const i of s)i[1](),x.push(i,e);if(m){for(let i=0;i<x.length;i+=2)x[i][0](x[i+1]);x.length=0}}}function r(v){o(v(e))}function h(v,m=A){const i=[v,m];return s.add(i),s.size===1&&(n=t(o,r)||A),v(e),()=>{s.delete(i),s.size===0&&n&&(n(),n=null)}}return{set:o,update:r,subscribe:h}}console.log("hi starting...");const Ge="worktree",O=ke([]),mt=vt(1).reverse();we(Ge).then(e=>{O.update(t=>e||mt)});let ee=null;O.save=()=>{ee&&clearTimeout(ee),ee=setTimeout(()=>{const e=ye(O);Te(Ge,e),ee=null},500)};O.push=({prevVersion:e,prompt:t,html:n})=>{let s=null;return O.update(o=>{if(Array.isArray(o)){var r=o.reverse().slice(0,e+1);return s=e+1,r.push({versionTag:s,prompt:t,html:n}),r.reverse()}return o}),s};function vt(e){return Array(e).fill(0).map((t,n)=>({versionTag:n,prompt:`oogabooga v${n}`,html:`<!DOCTYPE html>
				<html lang="en">
				<head>
					<meta charset="UTF-8">
					<meta name="viewport" content="width=device-width, initial-scale=1.0">
					<title>Svelte & Bootstrap Template</title>
					<!-- Latest Svelte version CDN -->
					<script defer src="https://cdn.jsdelivr.net/npm/svelte@3.42.4/dist/svelte.js"><\/script>
				
					<!-- Latest Bootstrap CSS and JS CDNs -->
					<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.5.0/dist/css/bootstrap.min.css" rel="stylesheet">
					<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.5.0/dist/js/bootstrap.bundle.min.js"><\/script>
				
					<style>
						/* Custom CSS for centering text */
						.center-text {
							text-align: center;
							padding: 20px;
						}
					</style>
				</head>
				<body>
					<!-- Svelte app container -->
					<div id="svelte-root" class="container-fluid">
						<div class="row justify-content-center">
							<div class="col-md-6 center-text">
								<h1>Hello, Svelte & Bootstrap!</h1>
								<p>This is a basic v${n} HTML template with a centered text container.</p>
							</div>
						</div>
					</div>
				
					<script>
						// Your Svelte components can be included here
					<\/script>
				</body>
				</html>
				`}))}const We="selection",K=ke({});we(We).then(e=>{K.update(t=>e||{})});let te=null;K.save=()=>{te&&clearTimeout(te),te=setTimeout(()=>{const e=ye(K);Te(We,e),te=null},500)};const Qe="settings",q=ke({});we(Qe).then(e=>{q.update(t=>e||{})});let ne=null;q.save=()=>{ne&&clearTimeout(ne),ne=setTimeout(()=>{const e=ye(q);Te(Qe,e),ne=null},500)};function Ce(e){let t,n;return{c(){t=d("div"),n=Y("Thinking..."),a(t,"style",e[1])},m(s,o){I(s,t,o),c(t,n)},p(s,o){o&2&&a(t,"style",s[1])},d(s){s&&S(t)}}}function gt(e){let t,n=e[0]&&Ce(e);return{c(){n&&n.c(),t=Ue()},m(s,o){n&&n.m(s,o),I(s,t,o)},p(s,[o]){s[0]?n?n.p(s,o):(n=Ce(s),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},i:A,o:A,d(s){s&&S(t),n&&n.d(s)}}}function _t(e,t,n){let{isInProgress:s=!1}=t,{style:o}=t;return e.$$set=r=>{"isInProgress"in r&&n(0,s=r.isInProgress),"style"in r&&n(1,o=r.style)},[s,o]}class yt extends ze{constructor(t){super(),Ye(this,t,_t,gt,_e,{isInProgress:0,style:1})}}const bt="https://api.openai.com/v1",Xe=async(e,t,n,s={})=>{console.log("[DEBUG] Calling open ai with instr, token, html as - ",t,n,e);let o=Object.assign({},{model:"gpt-3.5-turbo",messages:[{role:"system",content:"You are a master web frontend developer and designer who helps the user to design and code HTML web user interfaces (UIs), using svelteJs v3.42.4 & bootstrap 5.5.0. You will modify the provided HTML according to the user's instructions. Make only those changes that are asked by the user and do so using best practises in responsive design, w3c standards & web security. You will respond only with the output html, nothing else."},{role:"user",content:`Modify the provided html code as per the instructions below.
Html:"${e||""}"
Instructions:"${t||""}"`}],temperature:1,max_tokens:3097,top_p:1,frequency_penalty:0,presence_penalty:0},s);const r=await fetch(`${bt}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(o)});if(!r.ok){const m=(await r.json()).error.message,i=/This model's maximum context length is (\d+) tokens\. However, you requested (\d+) tokens \((\d+) in the messages, (\d+) in the completion\)\. Please reduce the length of the messages or completion\./,g=m.match(i);if(g){console.warn("max tokens exceeded. Retrying with adjusted max_tokens as below :-");const _=parseInt(g[1]),l=parseInt(g[2]),f=parseInt(g[3]),p=parseInt(g[4]);console.log("Max Context Length:",_),console.log("Requested Tokens:",l),console.log("Messages Tokens:",f),console.log("Completion Tokens:",p);const T=_-f;return console.log(`
New max_tokens = `,T),Xe(e,t,n,{max_tokens:T})}else throw console.log("No match for error."),new Error(`Non-200 response: ${await r.text()}`)}const h=await r.json();return console.log("[DEBUG] responseJSON - ",h),h};function xe(e,t,n){const s=e.slice();s[9]=t[n];const o=s[4](s[9].html||'<p style="text-align:center; width:100%;">NAe</p>',"text/html");return s[10]=o,s}function pe(e){const t=e.slice(),n=t[4](t[9].html,"text/html");return t[10]=n,t}function he(e){const t=e.slice(),n=t[3].find(s=>s.versionTag===t[2].versionTag);return t[9]=n,t}function Me(e){let t,n=e[9]&&Be(pe(e));return{c(){n&&n.c(),t=Ue()},m(s,o){n&&n.m(s,o),I(s,t,o)},p(s,o){s[9]?n?n.p(pe(s),o):(n=Be(pe(s)),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(s){s&&S(t),n&&n.d(s)}}}function Be(e){let t,n,s;return{c(){t=d("div"),n=d("iframe"),a(n,"title","main view"),oe(n.src,s=e[10])||a(n,"src",s),a(n,"class","svelte-1vdfi92"),a(t,"class","preview shadow rounded svelte-1vdfi92")},m(o,r){I(o,t,r),c(t,n)},p(o,r){r&12&&!oe(n.src,s=o[10])&&a(n,"src",s)},d(o){o&&S(t)}}}function Ke(e){let t,n,s,o,r=(e[9].versionTag>=0?e[9].versionTag:"notag")+"",h,v,m,i,g,_,l;return{c(){t=d("div"),n=d("div"),s=d("span"),o=Y("v"),h=Y(r),v=$(),m=d("iframe"),g=$(),a(s,"class","text svelte-1vdfi92"),a(n,"class","overlay p0-25 svelte-1vdfi92"),a(m,"title","preview"),a(m,"class","scaled-frame svelte-1vdfi92"),oe(m.src,i=e[10])||a(m,"src",i),a(t,"class","version-item shadow bordered rounded selected svelte-1vdfi92"),a(t,"role","listitem"),Oe(t,"selected",e[2]&&e[2].versionTag===e[9].versionTag)},m(f,p){I(f,t,p),c(t,n),c(n,s),c(s,o),c(s,h),c(t,v),c(t,m),c(t,g),_||(l=[re(t,"click",function(){ge(e[5](e[9]))&&e[5](e[9]).apply(this,arguments)}),re(t,"keypress",Tt)],_=!0)},p(f,p){e=f,p&8&&r!==(r=(e[9].versionTag>=0?e[9].versionTag:"notag")+"")&&rt(h,r),p&8&&!oe(m.src,i=e[10])&&a(m,"src",i),p&12&&Oe(t,"selected",e[2]&&e[2].versionTag===e[9].versionTag)},d(f){f&&S(t),_=!1,H(l)}}}function wt(e){let t,n,s,o,r,h,v,m,i,g,_,l,f,p,T,z,P,F,G,U,ie,$e,E,le,Se,L,D,Ie,W,R,ce,Q,J,ae,Pe;g=new yt({props:{style:"padding-right:1em;color:lightblue;font-weight:bold;",isInProgress:e[0]}});let b=e[2]&&e[2].versionTag>=0&&Me(he(e)),N=Ne(e[3]),y=[];for(let u=0;u<N.length;u+=1)y[u]=Ke(xe(e,N,u));return{c(){t=d("div"),t.innerHTML='<div class="column centered p1 svelte-1vdfi92"><h1 class="m0 p0 svelte-1vdfi92">Welcome to ThoughtForma AI</h1></div>',n=$(),s=d("div"),o=d("div"),r=d("div"),h=d("div"),v=d("input"),m=$(),i=d("div"),dt(g.$$.fragment),_=$(),l=d("div"),f=d("div"),b&&b.c(),p=$(),T=d("div"),z=$(),P=d("div"),F=d("div"),G=d("div"),U=d("details"),ie=d("summary"),ie.innerHTML="<b>Settings</b>",$e=$(),E=d("div"),le=d("small"),le.innerHTML='<h6 class="svelte-1vdfi92"><b>OpenAI Token</b></h6>',Se=$(),L=d("input"),Ie=$(),W=d("div"),R=d("div");for(let u=0;u<y.length;u+=1)y[u].c();ce=$(),Q=d("p"),Q.innerHTML='Visit <a href="https://kit.svelte.dev">kit.svelte.dev</a> to read the documentation',a(t,"class","row svelte-1vdfi92"),a(v,"class","m0 svelte-1vdfi92"),a(v,"placeholder","Type instruction prompt..."),a(i,"class","p1 svelte-1vdfi92"),Z(i,"position","absolute"),Z(i,"right","0"),a(h,"class","column left p1 flex svelte-1vdfi92"),Z(h,"align-items","center"),a(r,"class","row svelte-1vdfi92"),a(f,"class","column left p1 svelte-1vdfi92"),a(l,"class","row svelte-1vdfi92"),a(o,"class","column column-75 p1 centered svelte-1vdfi92"),a(T,"class","column centered bordered p0 svelte-1vdfi92"),Z(T,"width","1px"),a(L,"placeholder","Enter OpenAI API token"),a(L,"type","password"),L.value=D=e[1].openAIKey||"",a(E,"class","p1 svelte-1vdfi92"),a(G,"class","column svelte-1vdfi92"),a(F,"class","row svelte-1vdfi92"),a(R,"class","column svelte-1vdfi92"),a(W,"class","row svelte-1vdfi92"),a(P,"class","column column-25 p1 left scroll svelte-1vdfi92"),a(s,"class","row svelte-1vdfi92")},m(u,k){I(u,t,k),I(u,n,k),I(u,s,k),c(s,o),c(o,r),c(r,h),c(h,v),c(h,m),c(h,i),Je(g,i,null),c(o,_),c(o,l),c(l,f),b&&b.m(f,null),c(s,p),c(s,T),c(s,z),c(s,P),c(P,F),c(F,G),c(G,U),c(U,ie),c(U,$e),c(U,E),c(E,le),c(E,Se),c(E,L),c(P,Ie),c(P,W),c(W,R);for(let j=0;j<y.length;j+=1)y[j]&&y[j].m(R,null);I(u,ce,k),I(u,Q,k),J=!0,ae||(Pe=[re(v,"keypress",e[7]),re(L,"change",e[8])],ae=!0)},p(u,[k]){const j={};if(k&1&&(j.isInProgress=u[0]),g.$set(j),u[2]&&u[2].versionTag>=0?b?b.p(he(u),k):(b=Me(he(u)),b.c(),b.m(f,null)):b&&(b.d(1),b=null),(!J||k&2&&D!==(D=u[1].openAIKey||"")&&L.value!==D)&&(L.value=D),k&60){N=Ne(u[3]);let w;for(w=0;w<N.length;w+=1){const Ae=xe(u,N,w);y[w]?y[w].p(Ae,k):(y[w]=Ke(Ae),y[w].c(),y[w].m(R,null))}for(;w<y.length;w+=1)y[w].d(1);y.length=N.length}},i(u){J||(Re(g.$$.fragment,u),J=!0)},o(u){ft(g.$$.fragment,u),J=!1},d(u){u&&(S(t),S(n),S(s),S(ce),S(Q)),Ve(g),b&&b.d(),st(y,u),ae=!1,H(Pe)}}}const Tt=()=>{};function kt(e,t,n){let s,o,r;fe(e,q,l=>n(1,s=l)),fe(e,K,l=>n(2,o=l)),fe(e,O,l=>n(3,r=l));const h=(l,f)=>{const p=new Blob([l],{type:f});return URL.createObjectURL(p)},v=({versionTag:l})=>{console.log("selecting item - ",l),K.update(f=>Object.assign({},f,{versionTag:l})),K.save()},m=(l,f)=>{console.log("updateSettings - ",l,f),q.update(p=>(p[l]=f,p)),q.save()};let i=!1;return[i,s,o,r,h,v,m,l=>{if(l.key==="Enter"||l.keyCode===13){if(console.log("processing API request..."),n(0,i=!0),!r||r.length===0)throw n(0,i=!1),Error("treeStore cannot be empty while prompting");if(!o||o.versionTag<0||typeof o.versionTag!="number"){n(0,i=!1),alert("Please select a version first");return}(!s||!s.openAIKey)&&(n(0,i=!1),alert("Please add a valid OpenAI API key first"));var f=r.find(p=>p.versionTag===o.versionTag);if(!f){n(0,i=!1),alert("Version data is stale. Please select a version first...");return}Xe(f.html,l.target.value,s.openAIKey).then(p=>{if(console.log("open ai response - ",p),p&&p.choices){let T=p.choices[0];if(T&&T.finish_reason==="stop"){let z=T.message.content,P=O.push({prevVersion:f.versionTag,html:z,prompt:l.target.value});P&&v({versionTag:P}),O.save()}}l.target.value=""}).catch(p=>{console.error(p),alert("Something went wrong with the API call. Please try again or contact support.")}).then(()=>n(0,i=!1))}},l=>m("openAIKey",l.target.value)]}class $t extends ze{constructor(t){super(),Ye(this,t,kt,wt,_e,{})}}new $t({target:document.getElementById("app")});
